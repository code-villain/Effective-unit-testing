# Chapter6 신뢰성

- 만약 테스트를 믿지 못한다면 아무 관련 없어 보이는 코드라도 쉽사리 바꾸지 못한다.
- 6장의 테스트 냄새는 4장과 5장의 냄새를 복합적으로 가지고 있다. 즉, 가독성도 떨어뜨리고 유지보수도 어렵게 만든다.

## 테스트코드의 신뢰성을 떨어뜨리는 구린 냄새들
### 1. 주석으로 변한 테스트
- 테스트 코드가 주석이 되어 있는 경우.
    - 왜 주석처리 되었는지 알기 어렵다. (주석 처리한 이유를 찾기 위해 아까운 시간을 좀먹게 된다.)
    - 실행되어야 하는 테스트를 정상테스트로 오해하게 된다.
- 개선 방법 
    1. 테스트 코드가 성공한다면 주석을 풀어보자. **주석을 풀어서 돌리다 보면 주석을 하게 된 이유를 목격하게 될 수 있다. (같은 이유로 문제가 발생할테니!)** 그렇다면 이제 원인에 대처할 수 있도록 리팩토링하자.
    2. 테스트 코드가 실패했다면 미련없이 지워버리자. (우리는 버전관리를 한다.)

### 2. 오해를 낳는 주석
- 코드의 HOW를 설명하는 데, 설명을 그지같이해서 오히려 오해하게 만드는 주석.
- 개선 방법
    1. 주석대신 더 적절한 변수명이나 메서드명을 사용하라.
    2. 주석으로 설명하려던 코드 블럭읆 메서드로 추출하고 앎자은 이름을 지워줘라.
   
- 클린코드에서 말하는 주석과 비슷한 관점이다. 마틴 아조씨는 주석 혐오자다.
    > 주석은 순수하게 선하지 못하다. 주석은 기껏해야 필요악이다!
    > 주석은 나쁜 코드를 보완하지 못한다. 코드로 의도를 표현하라! 
    
- '무엇'이 아닌 '왜'를 설명하는 주석이 좋은 주석이다. (여기서도 How가 아니라 What이..ㅋㅋ)

### 3. 절대 실패하지 않는 테스트
- 테스트라면 실패해야 할 상황에서 반드시 실패해야 한다. **그렇지 않으면** 그릇된 안도감을 심어주게 된다.
- 개선 방법 : 실패해야 할 상황을 정확히 명시힌다. 예를들어 조건부 안의 단언문이나 catch문 안의 단언문이 실행되지 않았다면 이를 개발자가 알 수 있도록 fail();이나 expected를 사용하자. 

### 4. 지키지 못할 약속
- 테스트가 내새운 것보다 (= 테스트 메서드 이름), 훨씬 적은 것을 검사하는 경우.
    1. 아무 일도 안하는 경우 (텅 빈 메서드)
    2. 무언가 일은 하지만 정작 검증이 없는 경우 (단언문이 없는 경우)
    3. (메서드) 이름값 못하는 경우
- 개발자는 (메서드 이름에 명시된 것이) 정상적으로 검증을 하게 되었다고 오해하게 된다.
- 개선방법 : **테스트를 작성할 때 단언문 부터 적는다** (아주 어썸한 방법이다. 애용하는 습관을 길러보자.)
    - 단언문을 먼저 적을 때 기대되는 효과
        1. 단언문을 빼먹는 일이 없다. (위에서 언급한 1,2번 경우를 방지할 수 있다.)
        2. 테스트 (메서드) 이름과 단언문만 존재하게 되면, 단언문이 테스트 이름을 충족하는지 직접적으로 알기 쉽다.
    
### 5. 낮아진 기대치
- 쉬운 길(ex 모호한 단언문)을 찾다보니, 검증 정확도와 정밀도가 낮아진 경우. (책에서는 실제 기대값이 2나 5인 경우를 모두 0보다 크다로 퉁친경우를 예제로 설명한다.)
- 개선 방법 : 대충 짤려고 하지 말고 정확하게 테스트하자. 테스트의 본질에 맞도록!

### 6. 플랫폼 편견
- 필요한 플랫폼(ex OS)을 동등하게 다루지 못하는 테스트, 예를들어 맥에서 테스트를 돌린다면 윈도우용 테스트를 실행시키지 못하여 검증하지 못하는 경우.
- 개선 방법
    1. 플랫폼 종속적인 테스트 라는 것을 외부에 정확히 알린다. (맥에서 윈도우용 테스트를 돌린다면 중단되어야 정상이다. 이를 실패한 것으로 볼지는 좀 더 고민해봐야 할 영역)
    2. 근본적으로 제품 코드의 설계를 리팩토링 해본다.

### 7. 조건부 테스트
- 조건문 떄문에 테스트으가 의미하는 것과 다르게 동작할 수 있는 경우.
- 개선 방법 : 
    - 테스트 코드에 조건문이 있으면 일단 구린 냄새로 생각하자. 특히 그 안에 단언문이 있다면 필히! 손이 가야하는 코드다. 최소한 fail()을 이용하자. 
    - 테스트는 실패해야 할 땐 실패해야 한다. 
    - 조건문 보다는 명시적인 단언문을 사용하자.
