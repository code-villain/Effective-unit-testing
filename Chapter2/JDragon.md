# 02 좋은 테스트란?

좋은 테스트인지 만들기 위한 고려사항
- 테스트 코드의 가독성과 유지보수성
- 프로젝트 안에서, 그리고 소스파일 안에서 코드는 적절히 구조화되어 있는가
- 테스트가 무엇을 검사하는가
- 테스트는 안정적이고 반복 가능한가
- 테스트가 테스트 더블을 적절히 활용하는가

테스트의 품질을 평가하는 기준은 사람(팀)마다 다르다. 취향차이일 뿐이다.
그래도 어떤 테스트 코드가 좋은건지 판단하는 일반적인? 기준은 존재한다고 생각한다.

## 2.1 읽기 쉬운 코드가 유지보수도 쉽다

레거시 : 다른 누군가로부터 물려받아 관리해야 하는 코드 (대부분 읽기 어려운 코드다)
레거시 코드는 읽기 어렵기 때문에 유지보수가 어렵다. (이해하는데만 한세월)


## 2.2 구조화가 잘 되어 있다면 이해하기 쉽다

하나의 소스파일에 모든 코드가 전부 들어 있다?? 이해하기도 어렵고 손대기도 어렵다
이해할 수 있는 코드가 필요하다. 여러 소스 파일, 클래스, 메서드 단위로 나누기만 해도
봐야하는 코드의 양이 확 줄어든다

코드의 길이를 줄이는게 능사는 아니다. 코드가 도메인 모델이나 머릿속의 개념과 맞지 않아서
나눌 수 있는 명확한 경계를 찾을 수 없다면, 차라리 나누니 않느니만 못할 수도 있다.
고수준 개념을 구현된 코드에 빠르고 정확하게 대입할 수 있는 구조면 된다.

코드가 복잡하면 생기는 일
- 프로그램 에러를 발견하는데 오랜 시간이 걸린다
- 무엇이 어디에 영향을 주는지 알기 힘들다
- 사용중인 객체가 어디서 초기화 하는지 모른다

그래서 코드 동작 방식을 구체적으로 보여주는 테스트를 작성해야 한다.
읽기 쉽고, 찾기 쉽고, 이해하기 쉽도록 한 가지 기능에 충실한 테스트가 필요하다

읽기 쉽고, 찾기 쉽고, 이해하기 쉬운 코드의 이점
- 현재 작업과 관련된 테스트 클래스를 찾을 수 있다
- 그 클래스에서 적절한 테스트 메서드를 고를 수 있다
- 그 메서드에서 사용하는 객체의 생명주기를 이해할 수 있다

## 2.3 엉뚱한 걸 검사하는 건 좋지 않다

쓸데없는 수고를 없애기 위해 테스트 이름을 잘 지어야 한다.
유지보수 관점에서는 어떻게 구현했냐가 아니라 의도한 대로 구현했느냐를 검사하는게 중요하다

## 2.4 독립적인 테스트는 혼자서도 잘 실행된다

테스트가 얼마나 독립적인가를 잘 살펴야 한다. 이때 아키텍처의 경계부분이 특히 중요하다
경계에서 일어나는 일을 관찰하면서 수많은 코드 냄새를 맡을 수 있는데, 다음 요소와 관련이 있다면 특히 주의하자

- 시간
- 임의성
- 동시성
- 인프라
- 기존데이터
- 영속성
- 네트워킹

테스트 인프라 검증방법? 새 환경에서 코드를 내려받고 테스트를 실행한다

격리와 독립성이 중요한 이유는 그것이 없다면 테스트를 실행하고 관리하기가 어렵기 때문이다
ex) 특정경로의 파일을 읽는 테스트? 그럼 새 환경에서 테스트를 실행하려면 디렉토리를 다 만들어줘야 하나? 또는 OS 가 다르다면??

종속성은 우리가 제어할 수 없다는 특징이 있다. 제어할 수 없기 때문에 불규칙한 테스트가 만들어진다.

종속성을 피하기 위한 방법
- 테스트 더블을 이용하여 서드파티 라이브러리와의 종속성을 제거한다.
- 테스트에 필요한 자원을 테스트 코드와 같은 위치에 둔다
- 테스트가 사용할 자원을 직접 만들도록 한다
- 테스트가 필요한 문맥을 직접 설정하게 한다 -> 절대 다른 테스트에 의존하지 말자
- 영속성이 필요한 통합 테스트라면 인메모리 데이터베이스를 활용한다
- 스레드를 사용하는 코드는 동기식과 비동기식을 구분지어서 골치 아픈 동시성 문제는 소규모의 전문 테스트 그룹에 맡긴다.
  평범한 동기식 코드로 작성된 나머지 로직 대부분은 별다른 어려움 없이 검사할 수 있게 된다.

## 2.5 믿음직한 테스트라야 기댈 수 있다

예상과 전혀 다른걸 검사하거나 아무것도 검사하는 않는 테스트는 피해야 한다

절대 실패하지 않거나 항상 실패하는 테스트는 거의 있으나 마나다

테스트를 믿고 의지하려면 반복할 수 있게 만들어야 한다.
(System.currentTimeMillis() 와 같은 메서드가 테스트에 들어있으면 의심을 해봐야 한다. 늘 값이 바뀌기 때문에 테스트 결과의 일관성을 보장할 수 없을지도 모르기 때문이다)

비동기적 요소나 현재 시각에 종속된 코드를 포함한다면 그 부분을 인터페이스로 격리해야 한다
그렇게 하면 테스트 더블로 대체할 수 있어 반복 가능한 테스트를 만들 수 있다

## 2.6 모든 일이 그렇듯 테스트에도 도구가 쓰인다

테스트 더블이란 테스트를 위해 실제 구현체와 교체할 수 있는 객체다.

테스트 더블이 개선해주는 것
- 원래의 로직을 간소화된 코드로 코드로 대체하여 테스트 속도를 개선한다
- 만들어내기 어려운 특수한 상황을 시뮬레이션 한다
- 대상 객체의 내부 상태나 동작 등 테스트가 접근할 수 없던 정보를 얻어낸다

## 2.7 요약

- 이해하기 쉬운 가독성이 좋은 테스트를 만들어야 한다
- 잘 구조화된 테스트를 작성해야 코드를 빠르게 찾고 논리 흐림도 파악이 쉽다(가독성과 직결)
- 제대로 된걸 검사하는 테스트를 만들어야 한다
- 일관되게 동작하는 테스트를 만들어야 한다


